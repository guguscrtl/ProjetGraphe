<!DOCTYPE html>
<html>
<head>
  <title>Carte des villes - Vis.js</title>
  <script type="text/javascript" src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
  <style>
    #network, #network-oriented {
      width: 100%;
      height: 400px;
      border: 1px solid lightgray;
    }
  </style>
</head>
<body>
  <h2>RÃ©seau des villes</h2>
  <select id="algorithmSelect" onchange="verifyNeededStartPoint()">
    <option value="BFS">BFS</option>
    <option value="DFS">DFS</option>
    <option value="Kruskal">Kruskal</option>
    <option value="Prim">Prim</option>
    <option value="Dijkstra">Dijkstra</option>
    <option value="Floyd-Warshall">Floyd-Warshall</option>
  </select>
  <select id="startNodeSelect">
    <option value="0">Paris</option>
    <option value="1">Lille</option>
    <option value="2">Nancy</option>
    <option value="3">Grenoble</option>
    <option value="4">Lyon</option>
    <option value="5">Dijon</option>
    <option value="6">Caen</option>
    <option value="7">Rennes</option>
    <option value="8">Nantes</option>
    <option value="9">Bordeaux</option>
  </select>
  <button id="submit">Lancer l'algo</button>
  <div id="network"></div>
  <div id="network-oriented"></div>

  <script type="text/javascript">
    
    // --- NÅ’UDS AVEC POSITION FIXE ---
    const nodes = new vis.DataSet([
        { id: 0, label: "Paris", x: 0, y: 0, fixed: true },
        { id: 1, label: "Lille", x: 200, y: -200, fixed: true },
        { id: 2, label: "Nancy", x: 300, y: -50, fixed: true },
        { id: 3, label: "Grenoble", x: 250, y: 250, fixed: true },
        { id: 4, label: "Lyon", x: 150, y: 240, fixed: true },
        { id: 5, label: "Dijon", x: 100, y: 50, fixed: true },
        { id: 6, label: "Caen", x: -150, y: -150, fixed: true },
        { id: 7, label: "Rennes", x: -250, y: -50, fixed: true },
        { id: 8, label: "Nantes", x: -150, y: 100, fixed: true },
        { id: 9, label: "Bordeaux", x: -200, y: 250, fixed: true },
    ]);

    // --- ARÃŠTES ---
    const edges = new vis.DataSet([
      { from: 0, to: 1, label: '70', color: 'red' },
      { from: 0, to: 5, label: '60' },
      { from: 0, to: 6, label: '50' },
      { from: 0, to: 7, label: '110' },
      { from: 0, to: 8, label: '80' },
      { from: 0, to: 9, label: '150' },
      { from: 1, to: 2, label: '100' },
      { from: 1, to: 5, label: '120' },
      { from: 1, to: 6, label: '65' },
      { from: 2, to: 3, label: '80' },
      { from: 2, to: 4, label: '90' },
      { from: 2, to: 5, label: '75' },
      { from: 3, to: 4, label: '40' },
      { from: 3, to: 5, label: '75' },
      { from: 4, to: 5, label: '70' },
      { from: 4, to: 9, label: '100' },
      { from: 6, to: 7, label: '75' },
      { from: 7, to: 8, label: '45' },
      { from: 7, to: 9, label: '130' },
      { from: 8, to: 9, label: '90' }
    ]);

    const container = document.getElementById('network');
    const data = { nodes, edges };

    // --- OPTIONS ---
    var options = {
      physics: false,  // dÃ©sactive la physique (positions fixes)
      edges: {
        font: { align: 'middle' },
        color: { color: '#999' }
      },
      nodes: {
        shape: 'dot',
        size: 20,
        font: { size: 18 },
        color: { background: '#7EC8E3', border: '#036' }
      }
    };

    new vis.Network(container, data, options);

// --- NÅ’UDS ---
const nodes_oriented = new vis.DataSet([
  { id: 0, label: "Paris", x: 0, y: 0, fixed: true, shape: 'circularImage', image: 'static/img/tour_eiffel.jpg' },
  { id: 1, label: "Lille", x: 200, y: -200, fixed: true },
  { id: 2, label: "Nancy", x: 300, y: -50, fixed: true },
  { id: 3, label: "Grenoble", x: 250, y: 250, fixed: true },
  { id: 4, label: "Lyon", x: 150, y: 240, fixed: true },
  { id: 5, label: "Dijon", x: 100, y: 50, fixed: true },
  { id: 6, label: "Caen", x: -150, y: -150, fixed: true },
  { id: 7, label: "Rennes", x: -250, y: -50, fixed: true },
  { id: 8, label: "Nantes", x: -150, y: 100, fixed: true },
  { id: 9, label: "Bordeaux", x: -200, y: 250, fixed: true },
]);

// --- ARÃŠTES ORIENTÃ‰ES ---
const edges_oriented = new vis.DataSet([
  { from: 0, to: 1, label: '70', color: { color: '#ccc' }},
  { from: 0, to: 5, label: '60', color: { color: '#ccc' }},
  { from: 0, to: 6, label: '50', color: { color: '#ccc' }},
  { from: 0, to: 7, label: '110', color: { color: '#ccc' }},
  { from: 0, to: 8, label: '80', color: { color: '#ccc' }},
  { from: 0, to: 9, label: '150', color: { color: '#ccc' }},
  { from: 1, to: 2, label: '100', color: { color: '#ccc' }},
  { from: 1, to: 5, label: '120', color: { color: '#ccc' }},
  { from: 1, to: 6, label: '65', color: { color: '#ccc' }},
  { from: 2, to: 3, label: '80', color: { color: '#ccc' }},
  { from: 2, to: 4, label: '90', color: { color: '#ccc' }},
  { from: 2, to: 5, label: '75', color: { color: '#ccc' }},
  { from: 3, to: 4, label: '40', color: { color: '#ccc' }},
  { from: 3, to: 5, label: '75', color: { color: '#ccc' }},
  { from: 4, to: 5, label: '70', color: { color: '#ccc' }},
  { from: 4, to: 9, label: '100', color: { color: '#ccc' }},
  { from: 6, to: 7, label: '75', color: { color: '#ccc' }},
  { from: 7, to: 8, label: '45', color: { color: '#ccc' }},
  { from: 7, to: 9, label: '130', color: { color: '#ccc' }},
  { from: 8, to: 9, label: '90', color: { color: '#ccc' }},
]);

// --- OPTIONS ---
const options_oriented = {
  physics: false,
  edges: {
    arrows: 'to',
    smooth: false,
    font: { align: 'middle' },
    color: { color: '#999' },
  },
  nodes: {
    shape: 'dot',
    size: 20,
    font: { size: 18 },
    color: { background: '#7EC8E3', border: '#036' },
  },
};
const options_non_oriented = {
  physics: false,
  edges: {
    smooth: false,
    font: { align: 'middle' },
    color: { color: '#999' },
  },
  nodes: {
    shape: 'dot',
    size: 20,
    font: { size: 18 },
    color: { background: '#7EC8E3', border: '#036' },
  },
};


// --- INITIALISATION ---
const container_oriented = document.getElementById('network-oriented');
const container_non_oriented = document.getElementById('network');
const data_oriented = { nodes: nodes_oriented, edges: edges_oriented }; 
const network = new vis.Network(container_non_oriented, data, options);

// --- ANIMATION DU FLUX ROUGE ---
const ctx = network.canvas.frame.canvas.getContext('2d');


// ðŸ‘‰ Liste des arÃªtes Ã  animer
let pathEdges = [];

function buildPathEdges(path) {
  const edges = [];
  for (let i = 0; i < path.length; i++) {
    if (path[i] !== null && path[i] !== i) {
      edges.push({ from: i, to: path[i] });
    }
  }
  return edges;
}


function animateFlow() {
  const positions = network.getPositions();
  const time = (Date.now() / 10) % 100; // vitesse du flux

  // On efface la couche de dessin au-dessus du graphe
  network.redraw();

  ctx.save();
  ctx.lineWidth = 4;
  ctx.globalAlpha = 1;

  pathEdges.forEach((edge, i) => {
    const from = positions[edge.from];
    const to = positions[edge.to];
    if (!from || !to) return;

    // âœ… Conversion des coordonnÃ©es du graphe vers celles du canvas
    const fromCanvas = network.canvasToDOM({ x: from.x, y: from.y });
    const toCanvas = network.canvasToDOM({ x: to.x, y: to.y });

    const t = ((time + i * 20) % 100) / 100;
    const segmentLength = 0.2;
    const tStart = t;
    const tEnd = Math.min(t + segmentLength, 1);

    const x1 = fromCanvas.x + (toCanvas.x - fromCanvas.x) * tStart;
    const y1 = fromCanvas.y + (toCanvas.y - fromCanvas.y) * tStart;
    const x2 = fromCanvas.x + (toCanvas.x - fromCanvas.x) * tEnd;
    const y2 = fromCanvas.y + (toCanvas.y - fromCanvas.y) * tEnd;

    ctx.beginPath();
    ctx.strokeStyle = 'red';
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
  });

  ctx.restore();
  requestAnimationFrame(animateFlow);
}

async function findShortestPath(start, end, algo) {
  const response = await fetch('http://127.0.0.1:5000/shortest_path', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({start: start, end: end, algo: algo})
  });

  const data = await response.json();
  console.log("Chemin trouvÃ© :", data.path);
  pathEdges = buildPathEdges(data.path);
  console.log(pathEdges);

  //highlightPath(data.path);
}
window.addEventListener('DOMContentLoaded', () => {
  document.getElementById('submit').addEventListener('click', () => {
    const start = parseInt(document.getElementById('startNodeSelect').value);
    const algo = document.getElementById('algorithmSelect').value;
    findShortestPath(start, null, algo);
  });

  verifyNeededStartPoint();
});

function verifyNeededStartPoint() {
  const algorithm = document.getElementById('algorithmSelect').value;
  const startNodeSelect = document.getElementById('startNodeSelect');
  if (algorithm === 'Kruskal' || algorithm === 'Floyd-Warshall') {
    startNodeSelect.style.display = 'none';
  } else {
    startNodeSelect.style.display = 'inline';
  }
}

animateFlow();


</script>

</body>
</html>
